
@model List<Monster_University_GR2.Models.UsuarioResumenViewModel>
@{
    ViewBag.Title = "Reporte de Seguridad";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card shadow border-0 mt-4">
    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fas fa-shield-alt"></i> Reporte General de Seguridad</h5>
        <button onclick="abrirModalSeguridad()" class="btn btn-warning btn-sm fw-bold">
            <i class="fas fa-print"></i> Imprimir Listado
        </button>
    </div>
    <div class="card-body">

        <table id="tablaSeguridad" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Cédula</th>
                    <th>Nombres</th>
                    <th>Correo</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Cedula</td>

                        <td>@item.NombresCompletos</td>

                        <td>@item.Email</td>

                        <td class="text-center">
                            @if (item.Estado == "A")
                            {
                                <span class="badge bg-success">ACTIVO</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">INACTIVO</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>

<div class="modal fade" id="modalSeguridad" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">Vista Previa</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="contenedorSeguridad"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="imprimirSeguridad()">Imprimir</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 1. ACTIVAR DATATABLES (EN ESPAÑOL)
        $(document).ready(function () {
            $('#tablaSeguridad').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
                }
            });
        });

        // 2. ABRIR MODAL
        function abrirModalSeguridad() {
            var modal = new bootstrap.Modal(document.getElementById('modalSeguridad'));
            var contenedor = document.getElementById('contenedorSeguridad');

            modal.show();
            contenedor.innerHTML = '<div class="text-center p-4"><div class="spinner-border"></div></div>';

        fetch('@Url.Action("ReporteSeguridadPartial", "Reportes")')                .then(res => res.text())
                .then(html => contenedor.innerHTML = html);
        }

        // 3. IMPRIMIR (PRINT.JS)
// 3. IMPRIMIR (PRINT.JS con Estilos Pro)
function imprimirSeguridad() {
    printJS({
        printable: 'areaImpresionSeguridad', // ID que pusimos en el Partial
        type: 'html',
        scanStyles: true,     // Importante para leer los bordes de la tabla
        targetStyles: ['*'],  // Fuerza a copiar todos los estilos
        documentTitle: 'Reporte_Usuarios_MU',
        
        // CSS INYECTADO PARA LA IMPRESORA
        style: `
            @@page { 
                size: A4; 
                margin: 20mm; /* Márgenes de 2cm */
            }
            body { 
                font-family: 'Times New Roman', serif;
                -webkit-print-color-adjust: exact !important; /* Imprimir colores de fondo */
                print-color-adjust: exact !important; 
            }
            /* Ajuste para que la tabla no se corte a la mitad de una fila si es muy larga */
            tr { page-break-inside: avoid; }
        `
    });
}
    </script>
}